"use strict";var MosaicGen=(function(){var b=100;function E(a){return Math.random()*a}function F(a,n){return n=n||1,Math.ceil(a*n)/n}function R(a,n){return a+Math.random()*(n-a)}function U(a,n,f){return Math.max(n,Math.min(f,a))}function k(a,n,f){for(var e=f*f,t=0;t<n.length;t++){var r=a.x-n[t].x,o=a.y-n[t].y;if(r*r+o*o<e)return!1}return!0}function A(a){for(var n=a.width,f=a.height,e=a.pixels,t=[],r=0;r<f;r++){t[r]=[];for(var o=0;o<n;o++){for(var v=0,l=0,u=-1;u<=1;u++)for(var h=-1;h<=1;h++){var c=U(o+h,0,n-1),p=U(r+u,0,f-1),M=(p*n+c)*4,g=(e[M]+e[M+1]+e[M+2])/3,m=h===0?0:u===0?2*h:h,w=u===0?0:h===0?2*u:u;v+=g*m,l+=g*w}t[r][o]=Math.sqrt(v*v+l*l)}}return{edgeStrength:t}}function D(a,n,f){var e=a.width,t=a.height,r=[],o=Math.max(e,t)/15;r.push({x:0,y:0},{x:e-1,y:0},{x:0,y:t-1},{x:e-1,y:t-1});for(var v=1;v<8;v++){var l=v/8;r.push({x:l*(e-1),y:0},{x:l*(e-1),y:t-1}),r.push({x:0,y:l*(t-1)},{x:e-1,y:l*(t-1)})}for(var u=0,h=0;h<t;h++)for(var c=0;c<e;c++)u+=n.edgeStrength[h][c]+1;var p=Math.floor(f*.6),M=f-p,g=30;function m(){for(var z=E(u),V=0,C=0;C<t;C++)for(var S=0;S<e;S++)if(V+=n.edgeStrength[C][S]+1,V>=z)return{x:S,y:C};return{x:0,y:0}}for(var v=0;v<p;v++){for(var w=!1,i=0;i<g;i++){var s=m();if(k(s,r,o)){r.push(s),w=!0;break}}if(!w&&v>p*.5)for(var i=0;i<g;i++){var s=m();if(k(s,r,o*.7)){r.push(s);break}}}for(var v=0;v<M;v++){for(var w=!1,i=0;i<g;i++){var s={x:R(o,e-o),y:R(o,t-o)};if(k(s,r,o)){r.push(s),w=!0;break}}if(!w)for(var i=0;i<g;i++){var s={x:E(e),y:E(t)};if(k(s,r,o*.6)){r.push(s);break}}}return r}function G(a,n,f){for(var e=[],t=0;t<f;t++){e[t]=[];for(var r=0;r<n;r++){for(var o=1/0,v=-1,l=0;l<a.length;l++){var u=r-a[l].x,h=t-a[l].y,c=u*u+h*h;c<o&&(o=c,v=l)}e[t][r]=v}}return{map:e,seeds:a}}function N(a){if(a.length<3)return a;for(var n=a[0],f=1;f<a.length;f++){var e=a[f];(e.y<n.y||e.y===n.y&&e.x<n.x)&&(n=e)}var t=a.filter(function(u){return u!==n}).sort(function(u,h){return Math.atan2(u.y-n.y,u.x-n.x)-Math.atan2(h.y-n.y,h.x-n.x)});t.unshift(n);for(var r=[t[0],t[1]],f=2;f<t.length;f++){for(;r.length>=2;){var o=r[r.length-2],v=r[r.length-1],l=t[f];if((v.x-o.x)*(l.y-o.y)-(v.y-o.y)*(l.x-o.x)<=0)r.pop();else break}r.push(t[f])}return r}function O(a,n,f,e){for(var t=new Set,r=0;r<e;r++)for(var o=0;o<f;o++)if(a[r][o]===n){var v=o===0||o===f-1||r===0||r===e-1;if(!v){for(var l=-1;l<=1&&!v;l++)for(var u=-1;u<=1&&!v;u++)if(!(u===0&&l===0)){var h=o+u,c=r+l;h>=0&&h<f&&c>=0&&c<e&&a[c][h]!==n&&(v=!0)}}v&&t.add(o+","+r)}if(t.size===0)return[];var p=[];return t.forEach(function(M){var g=M.split(",");p.push({x:+g[0],y:+g[1]})}),N(p)}function W(a,n,f){for(var e=0,t=0,r=0,o=0,v=f.pixels,l=f.width,u=0;u<f.height;u++)for(var h=0;h<l;h++)if(a[u][h]===n){var c=(u*l+h)*4;e+=v[c],t+=v[c+1],r+=v[c+2],o++}return o===0?"rgb(128,128,128)":"rgb("+F(e/o,b)+","+F(t/o,b)+","+F(r/o,b)+")"}function q(a,n){for(var f=[],e=0;e<a.seeds.length;e++){var t=O(a.map,e,n.width,n.height);t.length<3||f.push({vertices:t,color:W(a.map,e,n)})}return f}return{generateVoronoiMosaic:function(a,n){var f=A(a),e=D(a,f,n),t=G(e,a.width,a.height);return q(t,a)}}})();
